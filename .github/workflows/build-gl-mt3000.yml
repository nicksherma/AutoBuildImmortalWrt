name: Build GL-MT3000 ImmortalWrt

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Set up job
      run: echo "Starting GL-MT3000 ImmortalWrt build..."

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y build-essential clang flex bison g++ gawk gcc-multilib g++-multilib \
        gettext git libncurses-dev libssl-dev python3-distutils rsync unzip zlib1g-dev file wget

    - name: Download ImageBuilder
      run: |
        curl -L -o imagebuilder.tar.xz https://downloads.immortalwrt.org/snapshots/targets/mediatek/filogic/immortalwrt-imagebuilder-mediatek-filogic.Linux-x86_64.tar.xz
        mkdir imagebuilder
        tar -xf imagebuilder.tar.xz -C imagebuilder --strip-components=1

    - name: Copy files into ImageBuilder
      run: |
        mkdir -p imagebuilder/files/etc
        echo "custom files go here" > imagebuilder/files/etc/dummy.txt

    - name: Run Build
      run: |
        cd imagebuilder
        make image PROFILE=zyxel_nbg7815-pro PACKAGES="luci" FILES=files

    - name: Upload firmware
      uses: actions/upload-artifact@v4
      with:
        name: GL-MT3000-Firmware
        path: imagebuilder/bin/targets/*/*/*.bin













